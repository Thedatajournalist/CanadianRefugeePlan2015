<!DOCTYPE html>

<html>



<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->

<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->

<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->

<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->

<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js"><!--<![endif]-->





<head>

  <meta charset="utf-8">

  <!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame 

       Remove this if you use the .htaccess -->

  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <title></title>

  <meta name="description" content="canadian refugee settlement prejection">

  <meta name="author" content="stella y. wu">



  <!--  Mobile viewport optimized: j.mp/bplateviewport -->

  <meta name="viewport" content="width=device-width, initial-scale=1.0">



  <script src="http://d3js.org/d3.v3.min.js"></script>

  <script src= "http://d3js.org/topojson.v1.min.js"></script>

  <!--script src="https://cdnjs.cloudflare.com/ajax/libs/d3-geo-projection/0.2.9/d3.geo.projection.min.js"</script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.19/topojson.min.js"</script-->

  <link type="text/css" rel="stylesheet" href="css/style.css" /> 

  

</head>





<body>

<div id='project-header' >

    <h1>Refugee Settlement prejection 2015</h1>

</div>





<div id='description'>

    <h2></h2>

        <p>I describe the context</p>

        <p>I explain the graph</p>

</div>



<div id='input'>

    <input name="ReverseButton"

           type="button"

           class="button"

           value="Number of refugees"

           onclick="revertData()" /><br>

    <p>

    <input name="updateButton"

           type="button"

           class="button"

           value="Per 1000 Canadians"

           onclick="updateData()" />



</div> 

<div id='map'>

    <script type="text/JavaScript">    



    var w = 1000;

    var h = 800;



    var svg = d3.select("#map")

            .insert("svg")

            .attr("width", w)

            .attr("height", h);

            

    var states=svg.append("g")

    .attr("id","states");

    

    

    var projection = d3.geo.azimuthalEqualArea()

                        .rotate([100, -45])

                        .center([5, 20])

                        .scale(1000)

                        .translate([w/2, h/2]);



    var path = d3.geo.path()

                .projection(projection);



//    var colourmap=d3.scale.linear()

//            .domain([0,12])

//            .range(["rgb(204, 88, 0)","rgb(255, 196, 153)"]);

//           .range(["rgb(255, 93, 0)","rgb(255, 195, 153)"]);

//     console.log(colourmap[0]);



        

    function hexToRgb(hex) {

    var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);

    return result ? {

        r: parseInt(result[1], 16),

        g: parseInt(result[2], 16),

        b: parseInt(result[3], 16)

    } : null;

}



     d3.json("canadatopo.json", function(ca) {

        console.log(ca.features)

        states.selectAll('path')

        .data(ca.features)

        .enter()

        .append('svg:path')

        .attr('d', path)

//        .style('fill', function(d,i){

//          console.log(i,hexToRgb(colourmap(i)));

//          return colourmap(i);})

        .attr("class",function(d,i) {

          console.log(i);

//          console.log("province"+i,hexToRgb(colourmap(i)));

          return "province" + i; })

        .style('stroke', 'white')

        .style('stroke-width', 0.5);        

        });



	 var rScale=d3.scale.sqrt()

            .domain([0,10000])

			.range([0,50]);



     var colorbubble = d3.scale.linear()

                    .domain([0,10000])

//                    .range(["rgb(204,254,255)","rgb(0,127,128)"]);  

//                     .range(["rgb(163,194,194)","rgb(41,61,61)"]);    

//                     .range(["white","rgb(41,61,61)"]);    

                     .range(["rgb(163, 194, 194)","rgb(41,61,61)"]);    



     var textbox = d3.select("#map").append("div")

                .attr("class","tooltip")

                .style("opacity",0);



//    draw circles



   

     d3.csv("refugee.csv",function(data) {

//        console.log(data)    

        svg.append("g")

        .attr("class","bubble")

        .selectAll("circle")

        .data(data)

        .enter()

        .append("circle")

        .attr("cx",function(d) {

//                console.log(d.lon, d.lat, projection([d.lon, d.lat]))    

                return projection([d.lon, d.lat])[0];

                })

        .attr("cy",function(d) {

                return projection([d.lon, d.lat])[1];

                })

        .attr("r",function(d) {

                return rScale(+d['NumberOfRefugee']);

                })

        .style("fill",function(d) {

                return colorbubble(+d['NumberOfRefugee']); 

                })        

        .on("mouseover", function(d) {

                textbox.transition()

                    .duration(200)

                    .style("opacity", .9);

                textbox.html((d['province'])+" refugees: "+(+d['NumberOfRefugee'])+"<br>"+"population: "+(+d['Population'])+"<br>"+"support: "+(+d['support']))

                    .style("left",(d3.event.pageX)+"px")

                    .style("top",(d3.event.pageY-28)+"px");

                })    

        .on("mouseout",function(d) {

                textbox.transition()

                    .duration(600)

                    .style("opacity",0);

                }) 



        }); 



//      updatedata

        function updateData() {

            d3.csv('refugee.csv',function(data){



                 data.forEach(function(d) {

                    d.percapita=(+d.NumberOfRefugee)*1000/(+d.Population);

                    });

            console.log(data);                    



                d3.selectAll("circle")

                    .transition()

                    .duration(2000)

                    .attr("r",function(d) {

                        return rScale((+d.NumberOfRefugee)*1000/(+d.Population));

                        })

                    .style("fill",function(d) {

                        return colorbubble((+d.NumberOfRefugee)*1000/(+d.Population)); 

                        });

              



            });        

        };



//     reverseData();         

        function revertData() {

            d3.csv('refugee.csv',function(data){



//                 data.forEach(function(d) {

//                    d.percapita=(+d.NumberOfRefugee)/(+d.Population);

//                    });

//            console.log(data);                    



                d3.selectAll("circle")

                    .transition()

                    .duration(2000)

                .attr("r",function(d) {

                        return rScale(+d['NumberOfRefugee']);

                        })

                .style("fill",function(d) {

                        return colorbubble(+d['NumberOfRefugee']); 

                        })        

              



            });        

        };



    </script>



</div>



<div id='footer'>

    Made by <a href='http://www.stellaywu.com' target="_blank">Stella Wu</a>, 2015.<br><a href='http://www.thedatajournalist.com' target="_blank">TheDataJournalist.com</a>

</div>



</body>

</html>
